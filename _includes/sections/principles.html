{%- comment -%}
Compact grouped-principles renderer
Expect data_source.principles to be a map:
  principles:
    program: [...]
    project: [...]
    mission: [...]
Inputs:
- section.data.principles_title
- section.data.principles  (array of ids, optional)
- section.data.principles_groups (array of strings, required)
- page.principles (fallback)
{%- endcomment -%}

{%- assign title = include.principles_title | default: section.data.principles_title | default: "Principles" -%}
{%- assign data_source = include.page_data | default: site.data.sections.principles -%}
{%- assign grouped = data_source.principles -%}
{%- assign src = include.principles | default: section.data.principles -%}
{%- assign principles_groups = include.principles_groups | default: section.data.principles_groups -%}
{%- assign final_items = "" | split: "|" -%}

{%- if src and principles_groups -%}
  {%- for want_id in src -%}
    {%- assign found = nil -%}
    {%- for key in principles_groups -%}
      {%- for candidate in grouped[key] -%}
        {%- if candidate.id == want_id -%}
          {%- assign found = candidate -%}
          {%- break -%}
        {%- endif -%}
        {%- if found -%}{%- break -%}{%- endif -%}
      {%- endfor -%}
    {%- if found -%}{%- break -%}{%- endif -%}
    {%- endfor -%}
  {%- if found -%}{%- assign final_items = final_items | push: found -%}{%- endif -%}
  {%- endfor -%}
{%- else -%}
  {%- for key in principles_groups -%}
    {%- if principles_groups and grouped[key] -%}
      {%- for item in grouped[key] -%}
        {%- assign final_items = final_items | push: item -%}
      {%- endfor -%}
    {%- endif -%}
  {%- endfor -%}
{%- endif -%}

<section class="md-flow">
  <h2>{{ title }}</h2>
  <dl>
    {%- for item in final_items -%}
      {%- assign _id = "principle-" | append: item.id | slugify -%}
      <dt id="{{ _id }}">{{ item.label }}</dt>
      <dd aria-labelledby="{{ _id }}">{{ item.description | markdownify }}</dd>
    {%- endfor -%}
  </dl>
</section>
