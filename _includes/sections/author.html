{%- comment -%}
author card within section

Expects:
  - include.author â†’ profile object
Notes:
  - Still uses site.data.program.levels to render the level icon color/label.
  - Still uses icons from /_includes/icons/*.svg (same paths as before).
This file now guards the markup with `if include.author` so it won't error
if called without an author object.
{%- endcomment -%}

{% assign author = include.item | default: include.author %}

<section class="md-card md-author-card">
  {% assign author_slug = author.slug | to_s | strip | slugify %}
  {% assign author_name = author.name | default: "Author" %}
  {% assign profile_url = '/authors/' | append: author_slug | append: '/' | relative_url %}
  {% assign avatar_path = '/media/author-avatar/' | append: author_slug | append: '.jpg' | relative_url %}

  <img
    src="{{ avatar_path }}"
    alt="{{ author_name }}"
    width="100"
    height="100"
  />

  <h2><a href="{{ profile_url }}">{{ author_name }}</a></h2>

  {%- if author.emoji_signature -%}
    <h3 class="author-card-emoji-signature"> {{ author.emoji_signature }} </h3>
  {%- endif -%}

  {%- assign title_value = author.title | to_s | strip -%}
  {%- assign title_mark_value = author.title_mark | to_s | strip -%}
  {%- assign has_title = title_value != "" and title_value != "null" -%}
  {%- assign has_title_mark = title_mark_value != "" and title_mark_value != "null" -%}
  {%- if has_title or has_title_mark -%}
    {%- capture title_rendered -%}
      {%- if has_title_mark -%}
        {%- capture mark_html -%}<mark>{{ title_mark_value }}</mark>{%- endcapture -%}
        {%- if has_title -%}
          {%- assign replaced = title_value | replace_first: title_mark_value, mark_html -%}
          {%- if replaced == title_value -%}
            {{ title_value }} {{ mark_html }}
          {%- else -%}
            {{ replaced }}
          {%- endif -%}
        {%- else -%}
          {{ mark_html }}
        {%- endif -%}
      {%- else -%}
        {{ title_value }}
      {%- endif -%}
    {%- endcapture -%}
    <p class="author-card-title">{{ title_rendered | strip }}</p>
  {%- endif -%}

  {%- assign ld = author.leadership_designations -%}
  {%- if ld -%}
    {%- assign lines = "" | split: "" -%}
    {%- for item in ld -%}
      {%- assign v = item.value | to_s | strip -%}
      {%- if v != "" and v != "null" -%}
        {%- assign lines = lines | push: v -%}
      {%- endif -%}
    {%- endfor -%}
    {%- if lines.size > 0 -%}
      <p>{{ lines | join: "<br>" }}</p>
    {%- endif -%}
  {%- endif -%}

  {%- if author.program_level -%}
    <div class="md-group">
      {%- if author.program_level -%}
        {% assign program_level = author.program_level | plus: 0 %}
        {% assign level = site.data.sections.program.sections | where: "type", "levels" | map: "data" | map: "items" | first | where: "level", program_level | first %}
        {% include icons/level.svg
          class="md-level-svg"
          color=level.color
          title=level.label %}
      {%- endif -%}
    </div>
  {%- endif -%}
</section>
